/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/aws-sdk@2.1342.0/lib/event-stream/build-message.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var util=require("../core").util,crypto=util.crypto,Int64=require("./int64").Int64,toBuffer=util.buffer.toBuffer,allocBuffer=util.buffer.alloc,Buffer=util.Buffer;function buildMessage(e){var r=buildHeaders(e.headers),t=allocBuffer(4);t.writeUInt32BE(r.length,0);var l=allocBuffer(4);l.writeUInt32BE(l.length+t.length+4+r.length+e.body.length+4,0);var a=Buffer.concat([l,t],l.length+t.length),u=crc32(a),n=Buffer.concat([a,u,r,e.body],a.length+u.length+r.length+e.body.length),f=crc32(n);return Buffer.concat([n,f])}function buildHeaders(e){for(var r=[],t=0,l=Object.keys(e),a=0;a<l.length;a++){var u=l[a],n=toBuffer(u),f=buildHeaderValue(e[u]),o=allocBuffer(1);o[0]=u.length,r.push(o,n,f),t+=o.length+n.length+f.length}for(var c=allocBuffer(t),E=0,i=0;i<r.length;i++)for(var g=r[i],B=0;B<g.length;B++)c[E]=g[B],E++;return c}function buildHeaderValue(e){switch(e.type){case"binary":var r=allocBuffer(3);return r.writeUInt8(HEADER_VALUE_TYPE.byteArray,0),r.writeUInt16BE(e.value.length,1),Buffer.concat([r,e.value],r.length+e.value.length);case"boolean":var t=allocBuffer(1);return t[0]=e.value?HEADER_VALUE_TYPE.boolTrue:HEADER_VALUE_TYPE.boolFalse,t;case"byte":var l=allocBuffer(2);return l[0]=HEADER_VALUE_TYPE.byte,l[1]=e.value,l;case"integer":var a=allocBuffer(5);return a.writeUInt8(HEADER_VALUE_TYPE.integer,0),a.writeInt32BE(e.value,1),a;case"long":var u=allocBuffer(1);return u[0]=HEADER_VALUE_TYPE.long,Buffer.concat([u,e.value.bytes],9);case"short":var n=allocBuffer(3);return n.writeUInt8(HEADER_VALUE_TYPE.short,0),n.writeInt16BE(e.value,1),n;case"string":var f=toBuffer(e.value),o=allocBuffer(3);return o.writeUInt8(HEADER_VALUE_TYPE.string,0),o.writeUInt16BE(f.length,1),Buffer.concat([o,f],o.length+f.length);case"timestamp":var c=allocBuffer(1);return c[0]=HEADER_VALUE_TYPE.timestamp,Buffer.concat([c,Int64.fromNumber(e.value.valueOf()).bytes],9);case"uuid":if(!UUID_PATTERN.test(e.value))throw new Error("Invalid UUID received: "+e.value);var E=allocBuffer(1);return E[0]=HEADER_VALUE_TYPE.uuid,Buffer.concat([E,toBuffer(e.value.replace(/\-/g,""),"hex")],17)}}function crc32(e){var r=crypto.crc32(e),t=allocBuffer(4);return t.writeUInt32BE(r,0),t}var HEADER_VALUE_TYPE={boolTrue:0,boolFalse:1,byte:2,short:3,integer:4,long:5,byteArray:6,string:7,timestamp:8,uuid:9},UUID_PATTERN=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;module.exports={buildMessage:buildMessage};
//# sourceMappingURL=/sm/144dc6ecb6cb5c7be21d4a083e71cd5fc927ec8b905e094ea49ad801b8aee5c1.map
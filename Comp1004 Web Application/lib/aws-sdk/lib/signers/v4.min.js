/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/aws-sdk@2.1342.0/lib/signers/v4.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var AWS=require("../core"),v4Credentials=require("./v4_credentials"),inherit=AWS.util.inherit,expiresHeader="presigned-expires";AWS.Signers.V4=inherit(AWS.Signers.RequestSigner,{constructor:function(e,t,s){AWS.Signers.RequestSigner.call(this,e),this.serviceName=t,s=s||{},this.signatureCache="boolean"!=typeof s.signatureCache||s.signatureCache,this.operation=s.operation,this.signatureVersion=s.signatureVersion},algorithm:"AWS4-HMAC-SHA256",addAuthorization:function(e,t){var s=AWS.util.date.iso8601(t).replace(/[:\-]|\.\d{3}/g,"");this.isPresigned()?this.updateForPresigned(e,s):this.addHeaders(e,s),this.request.headers.Authorization=this.authorization(e,s)},addHeaders:function(e,t){this.request.headers["X-Amz-Date"]=t,e.sessionToken&&(this.request.headers["x-amz-security-token"]=e.sessionToken)},updateForPresigned:function(e,t){var s=this.credentialString(t),i={"X-Amz-Date":t,"X-Amz-Algorithm":this.algorithm,"X-Amz-Credential":e.accessKeyId+"/"+s,"X-Amz-Expires":this.request.headers[expiresHeader],"X-Amz-SignedHeaders":this.signedHeaders()};e.sessionToken&&(i["X-Amz-Security-Token"]=e.sessionToken),this.request.headers["Content-Type"]&&(i["Content-Type"]=this.request.headers["Content-Type"]),this.request.headers["Content-MD5"]&&(i["Content-MD5"]=this.request.headers["Content-MD5"]),this.request.headers["Cache-Control"]&&(i["Cache-Control"]=this.request.headers["Cache-Control"]),AWS.util.each.call(this,this.request.headers,(function(e,t){if(e!==expiresHeader&&this.isSignableHeader(e)){var s=e.toLowerCase();0===s.indexOf("x-amz-meta-")?i[s]=t:0===s.indexOf("x-amz-")&&(i[e]=t)}}));var r=this.request.path.indexOf("?")>=0?"&":"?";this.request.path+=r+AWS.util.queryParamsToString(i)},authorization:function(e,t){var s=[],i=this.credentialString(t);return s.push(this.algorithm+" Credential="+e.accessKeyId+"/"+i),s.push("SignedHeaders="+this.signedHeaders()),s.push("Signature="+this.signature(e,t)),s.join(", ")},signature:function(e,t){var s=v4Credentials.getSigningKey(e,t.substr(0,8),this.request.region,this.serviceName,this.signatureCache);return AWS.util.crypto.hmac(s,this.stringToSign(t),"hex")},stringToSign:function(e){var t=[];return t.push("AWS4-HMAC-SHA256"),t.push(e),t.push(this.credentialString(e)),t.push(this.hexEncodedHash(this.canonicalString())),t.join("\n")},canonicalString:function(){var e=[],t=this.request.pathname();return"s3"!==this.serviceName&&"s3v4"!==this.signatureVersion&&(t=AWS.util.uriEscapePath(t)),e.push(this.request.method),e.push(t),e.push(this.request.search()),e.push(this.canonicalHeaders()+"\n"),e.push(this.signedHeaders()),e.push(this.hexEncodedBodyHash()),e.join("\n")},canonicalHeaders:function(){var e=[];AWS.util.each.call(this,this.request.headers,(function(t,s){e.push([t,s])})),e.sort((function(e,t){return e[0].toLowerCase()<t[0].toLowerCase()?-1:1}));var t=[];return AWS.util.arrayEach.call(this,e,(function(e){var s=e[0].toLowerCase();if(this.isSignableHeader(s)){var i=e[1];if(null==i||"function"!=typeof i.toString)throw AWS.util.error(new Error("Header "+s+" contains invalid value"),{code:"InvalidHeader"});t.push(s+":"+this.canonicalHeaderValues(i.toString()))}})),t.join("\n")},canonicalHeaderValues:function(e){return e.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"")},signedHeaders:function(){var e=[];return AWS.util.each.call(this,this.request.headers,(function(t){t=t.toLowerCase(),this.isSignableHeader(t)&&e.push(t)})),e.sort().join(";")},credentialString:function(e){return v4Credentials.createScope(e.substr(0,8),this.request.region,this.serviceName)},hexEncodedHash:function(e){return AWS.util.crypto.sha256(e,"hex")},hexEncodedBodyHash:function(){var e=this.request;return this.isPresigned()&&["s3","s3-object-lambda"].indexOf(this.serviceName)>-1&&!e.body?"UNSIGNED-PAYLOAD":e.headers["X-Amz-Content-Sha256"]?e.headers["X-Amz-Content-Sha256"]:this.hexEncodedHash(this.request.body||"")},unsignableHeaders:["authorization","content-type","content-length","user-agent",expiresHeader,"expect","x-amzn-trace-id"],isSignableHeader:function(e){return 0===e.toLowerCase().indexOf("x-amz-")||this.unsignableHeaders.indexOf(e)<0},isPresigned:function(){return!!this.request.headers[expiresHeader]}}),module.exports=AWS.Signers.V4;
//# sourceMappingURL=/sm/a7991e1f834761854352664800ad55981779235d14a66d26d5e9a6e773aa8caf.map
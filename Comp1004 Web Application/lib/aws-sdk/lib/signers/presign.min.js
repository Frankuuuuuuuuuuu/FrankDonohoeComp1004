/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/aws-sdk@2.1342.0/lib/signers/presign.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var AWS=require("../core"),inherit=AWS.util.inherit,expiresHeader="presigned-expires";function signedUrlBuilder(e){var r=e.httpRequest.headers[expiresHeader],t=e.service.getSignerClass(e);if(delete e.httpRequest.headers["User-Agent"],delete e.httpRequest.headers["X-Amz-User-Agent"],t===AWS.Signers.V4){if(r>604800){throw AWS.util.error(new Error,{code:"InvalidExpiryTime",message:"Presigning does not support expiry time greater than a week with SigV4 signing.",retryable:!1})}e.httpRequest.headers[expiresHeader]=r}else{if(t!==AWS.Signers.S3)throw AWS.util.error(new Error,{message:"Presigning only supports S3 or SigV4 signing.",code:"UnsupportedSigner",retryable:!1});var i=e.service?e.service.getSkewCorrectedDate():AWS.util.date.getDate();e.httpRequest.headers[expiresHeader]=parseInt(AWS.util.date.unixTimestamp(i)+r,10).toString()}}function signedUrlSigner(e){var r=e.httpRequest.endpoint,t=AWS.util.urlParse(e.httpRequest.path),i={};t.search&&(i=AWS.util.queryStringParse(t.search.substr(1)));var s=e.httpRequest.headers.Authorization.split(" ");if("AWS"===s[0])s=s[1].split(":"),i.Signature=s.pop(),i.AWSAccessKeyId=s.join(":"),AWS.util.each(e.httpRequest.headers,(function(e,r){e===expiresHeader&&(e="Expires"),0===e.indexOf("x-amz-meta-")&&(delete i[e],e=e.toLowerCase()),i[e]=r})),delete e.httpRequest.headers[expiresHeader],delete i.Authorization,delete i.Host;else if("AWS4-HMAC-SHA256"===s[0]){s.shift();var n=s.join(" ").match(/Signature=(.*?)(?:,|\s|\r?\n|$)/)[1];i["X-Amz-Signature"]=n,delete i.Expires}r.pathname=t.pathname,r.search=AWS.util.queryParamsToString(i)}AWS.Signers.Presign=inherit({sign:function(e,r,t){if(e.httpRequest.headers[expiresHeader]=r||3600,e.on("build",signedUrlBuilder),e.on("sign",signedUrlSigner),e.removeListener("afterBuild",AWS.EventListeners.Core.SET_CONTENT_LENGTH),e.removeListener("afterBuild",AWS.EventListeners.Core.COMPUTE_SHA256),e.emit("beforePresign",[e]),!t){if(e.build(),e.response.error)throw e.response.error;return AWS.util.urlFormat(e.httpRequest.endpoint)}e.build((function(){this.response.error?t(this.response.error):t(null,AWS.util.urlFormat(e.httpRequest.endpoint))}))}}),module.exports=AWS.Signers.Presign;
//# sourceMappingURL=/sm/5efa4db66888c9a9db9557af20168e842b0aa1ae5f1cb7609ff317972614f1b5.map
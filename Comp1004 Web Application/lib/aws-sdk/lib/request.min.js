/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/aws-sdk@2.1342.0/lib/request.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var AWS=require("./core"),AcceptorStateMachine=require("./state_machine"),inherit=AWS.util.inherit,domain=AWS.util.domain,jmespath=require("jmespath"),hardErrorStates={success:1,error:1,complete:1};function isTerminalState(e){return Object.prototype.hasOwnProperty.call(hardErrorStates,e._asm.currentState)}var fsm=new AcceptorStateMachine;fsm.setupStates=function(){var e=function(e,t){var r=this;r._haltHandlersOnError=!1,r.emit(r._asm.currentState,(function(e){if(e)if(isTerminalState(r)){if(!(domain&&r.domain instanceof domain.Domain))throw e;e.domainEmitter=r,e.domain=r.domain,e.domainThrown=!1,r.domain.emit("error",e)}else r.response.error=e,t(e);else t(r.response.error)}))};this.addState("validate","build","error",e),this.addState("build","afterBuild","restart",e),this.addState("afterBuild","sign","restart",e),this.addState("sign","send","retry",e),this.addState("retry","afterRetry","afterRetry",e),this.addState("afterRetry","sign","error",e),this.addState("send","validateResponse","retry",e),this.addState("validateResponse","extractData","extractError",e),this.addState("extractError","extractData","retry",e),this.addState("extractData","success","retry",e),this.addState("restart","build","error",e),this.addState("success","complete","complete",e),this.addState("error","complete","complete",e),this.addState("complete",null,null,e)},fsm.setupStates(),AWS.Request=inherit({constructor:function(e,t,r){var n=e.endpoint,i=e.config.region,s=e.config.customUserAgent;e.signingRegion?i=e.signingRegion:e.isGlobalEndpoint&&(i="us-east-1"),this.domain=domain&&domain.active,this.service=e,this.operation=t,this.params=r||{},this.httpRequest=new AWS.HttpRequest(n,i),this.httpRequest.appendToUserAgent(s),this.startTime=e.getSkewCorrectedDate(),this.response=new AWS.Response(this),this._asm=new AcceptorStateMachine(fsm.states,"validate"),this._haltHandlersOnError=!1,AWS.SequentialExecutor.call(this),this.emit=this.emitEvent},send:function(e){return e&&(this.httpRequest.appendToUserAgent("callback"),this.on("complete",(function(t){e.call(t,t.error,t.data)}))),this.runTo(),this.response},build:function(e){return this.runTo("send",e)},runTo:function(e,t){return this._asm.runTo(e,t,this),this},abort:function(){return this.removeAllListeners("validateResponse"),this.removeAllListeners("extractError"),this.on("validateResponse",(function(e){e.error=AWS.util.error(new Error("Request aborted by user"),{code:"RequestAbortedError",retryable:!1})})),this.httpRequest.stream&&!this.httpRequest.stream.didCallback&&(this.httpRequest.stream.abort(),this.httpRequest._abortCallback?this.httpRequest._abortCallback():this.removeAllListeners("send")),this},eachPage:function(e){e=AWS.util.fn.makeAsync(e,3),this.on("complete",(function t(r){e.call(r,r.error,r.data,(function(n){!1!==n&&(r.hasNextPage()?r.nextPage().on("complete",t).send():e.call(r,null,null,AWS.util.fn.noop))}))})).send()},eachItem:function(e){var t=this;this.eachPage((function(r,n){if(r)return e(r,null);if(null===n)return e(null,null);var i=t.service.paginationConfig(t.operation).resultKey;Array.isArray(i)&&(i=i[0]);var s=jmespath.search(n,i),a=!0;return AWS.util.arrayEach(s,(function(t){if(!1===(a=e(null,t)))return AWS.util.abort})),a}))},isPageable:function(){return!!this.service.paginationConfig(this.operation)},createReadStream:function(){var e=AWS.util.stream,t=this,r=null;return 2===AWS.HttpClient.streamsApiVersion?(r=new e.PassThrough,process.nextTick((function(){t.send()}))):((r=new e.Stream).readable=!0,r.sent=!1,r.on("newListener",(function(e){r.sent||"data"!==e||(r.sent=!0,process.nextTick((function(){t.send()})))}))),this.on("error",(function(e){r.emit("error",e)})),this.on("httpHeaders",(function(n,i,s){if(n<300){t.removeListener("httpData",AWS.EventListeners.Core.HTTP_DATA),t.removeListener("httpError",AWS.EventListeners.Core.HTTP_ERROR),t.on("httpError",(function(e){s.error=e,s.error.retryable=!1}));var a,o=!1;if("HEAD"!==t.httpRequest.method&&(a=parseInt(i["content-length"],10)),void 0!==a&&!isNaN(a)&&a>=0){o=!0;var u=0}var h=function(){o&&u!==a?r.emit("error",AWS.util.error(new Error("Stream content length mismatch. Received "+u+" of "+a+" bytes."),{code:"StreamContentLengthMismatch"})):2===AWS.HttpClient.streamsApiVersion?r.end():r.emit("end")},c=s.httpResponse.createUnbufferedStream();if(2===AWS.HttpClient.streamsApiVersion)if(o){var l=new e.PassThrough;l._write=function(t){return t&&t.length&&(u+=t.length),e.PassThrough.prototype._write.apply(this,arguments)},l.on("end",h),r.on("error",(function(e){o=!1,c.unpipe(l),l.emit("end"),l.end()})),c.pipe(l).pipe(r,{end:!1})}else c.pipe(r);else o&&c.on("data",(function(e){e&&e.length&&(u+=e.length)})),c.on("data",(function(e){r.emit("data",e)})),c.on("end",h);c.on("error",(function(e){o=!1,r.emit("error",e)}))}})),r},emitEvent:function(e,t,r){"function"==typeof t&&(r=t,t=null),r||(r=function(){}),t||(t=this.eventParameters(e,this.response)),AWS.SequentialExecutor.prototype.emit.call(this,e,t,(function(e){e&&(this.response.error=e),r.call(this,e)}))},eventParameters:function(e){switch(e){case"restart":case"validate":case"sign":case"build":case"afterValidate":case"afterBuild":return[this];case"error":return[this.response.error,this.response];default:return[this.response]}},presign:function(e,t){return t||"function"!=typeof e||(t=e,e=null),(new AWS.Signers.Presign).sign(this.toGet(),e,t)},isPresigned:function(){return Object.prototype.hasOwnProperty.call(this.httpRequest.headers,"presigned-expires")},toUnauthenticated:function(){return this._unAuthenticated=!0,this.removeListener("validate",AWS.EventListeners.Core.VALIDATE_CREDENTIALS),this.removeListener("sign",AWS.EventListeners.Core.SIGN),this},toGet:function(){return"query"!==this.service.api.protocol&&"ec2"!==this.service.api.protocol||(this.removeListener("build",this.buildAsGet),this.addListener("build",this.buildAsGet)),this},buildAsGet:function(e){e.httpRequest.method="GET",e.httpRequest.path=e.service.endpoint.path+"?"+e.httpRequest.body,e.httpRequest.body="",delete e.httpRequest.headers["Content-Length"],delete e.httpRequest.headers["Content-Type"]},haltHandlersOnError:function(){this._haltHandlersOnError=!0}}),AWS.Request.addPromisesToClass=function(e){this.prototype.promise=function(){var t=this;return this.httpRequest.appendToUserAgent("promise"),new e((function(e,r){t.on("complete",(function(t){t.error?r(t.error):e(Object.defineProperty(t.data||{},"$response",{value:t}))})),t.runTo()}))}},AWS.Request.deletePromisesFromClass=function(){delete this.prototype.promise},AWS.util.addPromises(AWS.Request),AWS.util.mixin(AWS.Request,AWS.SequentialExecutor);
//# sourceMappingURL=/sm/82cabc96f4a88a00b0cf482ebd3b5547a35b513b959c9974c3609eceb0ae0daf.map
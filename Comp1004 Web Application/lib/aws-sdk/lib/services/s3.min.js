/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/aws-sdk@2.1342.0/lib/services/s3.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var AWS=require("../core"),v4Credentials=require("../signers/v4_credentials"),resolveRegionalEndpointsFlag=require("../config_regional_endpoint"),s3util=require("./s3util"),regionUtil=require("../region_config");require("../s3/managed_upload");var operationsWith200StatusCodeError={completeMultipartUpload:!0,copyObject:!0,uploadPartCopy:!0},regionRedirectErrorCodes=["AuthorizationHeaderMalformed","BadRequest","PermanentRedirect",301],OBJECT_LAMBDA_SERVICE="s3-object-lambda";AWS.util.update(AWS.S3.prototype,{getSignatureVersion:function(e){var t=this.api.signatureVersion,r=this._originalConfig?this._originalConfig.signatureVersion:null,i=this.config.signatureVersion,n=!!e&&e.isPresigned();return r?r="v2"===r?"s3":r:(!0!==n?t="v4":i&&(t=i),t)},getSigningName:function(e){if(e&&"writeGetObjectResponse"===e.operation)return OBJECT_LAMBDA_SERVICE;var t=AWS.Service.prototype.getSigningName;return e&&e._parsedArn&&e._parsedArn.service?e._parsedArn.service:t.call(this)},getSignerClass:function(e){var t=this.getSignatureVersion(e);return AWS.Signers.RequestSigner.getVersion(t)},validateService:function(){var e,t=[];if(this.config.region||(this.config.region="us-east-1"),!this.config.endpoint&&this.config.s3BucketEndpoint&&t.push("An endpoint must be provided when configuring `s3BucketEndpoint` to true."),1===t.length?e=t[0]:t.length>1&&(e="Multiple configuration errors:\n"+t.join("\n")),e)throw AWS.util.error(new Error,{name:"InvalidEndpoint",message:e})},shouldDisableBodySigning:function(e){var t=this.getSignerClass();return!0===this.config.s3DisableBodySigning&&t===AWS.Signers.V4&&"https:"===e.httpRequest.endpoint.protocol},setupRequestListeners:function(e){if(e.addListener("validate",this.validateScheme),e.addListener("validate",this.validateBucketName,true),e.addListener("validate",this.optInUsEast1RegionalEndpoint,true),e.removeListener("validate",AWS.EventListeners.Core.VALIDATE_REGION),e.addListener("build",this.addContentType),e.addListener("build",this.computeContentMd5),e.addListener("build",this.computeSseCustomerKeyMd5),e.addListener("build",this.populateURI),e.addListener("afterBuild",this.addExpect100Continue),e.addListener("extractError",this.extractError),e.addListener("extractData",AWS.util.hoistPayloadMember),e.addListener("extractData",this.extractData),e.addListener("extractData",this.extractErrorFrom200Response),e.addListener("beforePresign",this.prepareSignedUrl),this.shouldDisableBodySigning(e)&&(e.removeListener("afterBuild",AWS.EventListeners.Core.COMPUTE_SHA256),e.addListener("afterBuild",this.disableBodySigning)),"createBucket"!==e.operation&&s3util.isArnInParam(e,"Bucket"))return e._parsedArn=AWS.util.ARN.parse(e.params.Bucket),e.removeListener("validate",this.validateBucketName),e.removeListener("build",this.populateURI),"s3"===e._parsedArn.service?(e.addListener("validate",s3util.validateS3AccessPointArn),e.addListener("validate",this.validateArnResourceType),e.addListener("validate",this.validateArnRegion)):"s3-outposts"===e._parsedArn.service&&(e.addListener("validate",s3util.validateOutpostsAccessPointArn),e.addListener("validate",s3util.validateOutpostsArn),e.addListener("validate",s3util.validateArnRegion)),e.addListener("validate",s3util.validateArnAccount),e.addListener("validate",s3util.validateArnService),e.addListener("build",this.populateUriFromAccessPointArn),void e.addListener("build",s3util.validatePopulateUriFromArn);e.addListener("validate",this.validateBucketEndpoint),e.addListener("validate",this.correctBucketRegionFromCache),e.onAsync("extractError",this.requestBucketRegion),AWS.util.isBrowser()&&e.onAsync("retry",this.reqRegionForNetworkingError)},validateScheme:function(e){var t=e.params,r=e.httpRequest.endpoint.protocol;if((t.SSECustomerKey||t.CopySourceSSECustomerKey)&&"https:"!==r){throw AWS.util.error(new Error,{code:"ConfigError",message:"Cannot send SSE keys over HTTP. Set 'sslEnabled'to 'true' in your configuration"})}},validateBucketEndpoint:function(e){if(!e.params.Bucket&&e.service.config.s3BucketEndpoint){throw AWS.util.error(new Error,{code:"ConfigError",message:"Cannot send requests to root API with `s3BucketEndpoint` set."})}},validateArnRegion:function(e){s3util.validateArnRegion(e,{allowFipsEndpoint:!0})},validateArnResourceType:function(e){var t=e._parsedArn.resource;if(0!==t.indexOf("accesspoint:")&&0!==t.indexOf("accesspoint/"))throw AWS.util.error(new Error,{code:"InvalidARN",message:"ARN resource should begin with 'accesspoint/'"})},validateBucketName:function(e){var t=e.service.getSignatureVersion(e),r=e.params&&e.params.Bucket,i=e.params&&e.params.Key,n=r&&r.indexOf("/");if(r&&n>=0)if("string"==typeof i&&n>0){e.params=AWS.util.copy(e.params);var o=r.substr(n+1)||"";e.params.Key=o+"/"+i,e.params.Bucket=r.substr(0,n)}else if("v4"===t){var s="Bucket names cannot contain forward slashes. Bucket: "+r;throw AWS.util.error(new Error,{code:"InvalidBucket",message:s})}},isValidAccelerateOperation:function(e){return-1===["createBucket","deleteBucket","listBuckets"].indexOf(e)},optInUsEast1RegionalEndpoint:function(e){var t=e.service,r=t.config;if(r.s3UsEast1RegionalEndpoint=resolveRegionalEndpointsFlag(t._originalConfig,{env:"AWS_S3_US_EAST_1_REGIONAL_ENDPOINT",sharedConfig:"s3_us_east_1_regional_endpoint",clientConfig:"s3UsEast1RegionalEndpoint"}),!(t._originalConfig||{}).endpoint&&"us-east-1"===e.httpRequest.region&&"regional"===r.s3UsEast1RegionalEndpoint&&e.httpRequest.endpoint.hostname.indexOf("s3.amazonaws.com")>=0){var i=r.endpoint.indexOf(".amazonaws.com");regionalEndpoint=r.endpoint.substring(0,i)+".us-east-1"+r.endpoint.substring(i),e.httpRequest.updateEndpoint(regionalEndpoint)}},populateURI:function(e){var t=e.httpRequest,r=e.params.Bucket,i=e.service,n=t.endpoint;if(r&&!i.pathStyleBucketName(r)){i.config.useAccelerateEndpoint&&i.isValidAccelerateOperation(e.operation)?i.config.useDualstackEndpoint?n.hostname=r+".s3-accelerate.dualstack.amazonaws.com":n.hostname=r+".s3-accelerate.amazonaws.com":i.config.s3BucketEndpoint||(n.hostname=r+"."+n.hostname);var o=n.port;n.host=80!==o&&443!==o?n.hostname+":"+n.port:n.hostname,t.virtualHostedBucket=r,i.removeVirtualHostedBucketFromPath(e)}},removeVirtualHostedBucketFromPath:function(e){var t=e.httpRequest,r=t.virtualHostedBucket;if(r&&t.path){if(e.params&&e.params.Key){var i="/"+AWS.util.uriEscapePath(e.params.Key);if(0===t.path.indexOf(i)&&(t.path.length===i.length||"?"===t.path[i.length]))return}t.path=t.path.replace(new RegExp("/"+r),""),"/"!==t.path[0]&&(t.path="/"+t.path)}},populateUriFromAccessPointArn:function(e){var t=e._parsedArn,r="s3-outposts"===t.service,i="s3-object-lambda"===t.service,n=r?"."+t.outpostId:"",o=r?"s3-outposts":"s3-accesspoint",s=!r&&e.service.config.useFipsEndpoint?"-fips":"",a=!r&&e.service.config.useDualstackEndpoint?".dualstack":"",u=e.httpRequest.endpoint,c=regionUtil.getEndpointSuffix(t.region),d=e.service.config.s3UseArnRegion;if(u.hostname=[t.accessPoint+"-"+t.accountId+n,o+s+a,d?t.region:e.service.config.region,c].join("."),i){o="s3-object-lambda";var p=t.resource.split("/")[1];s=e.service.config.useFipsEndpoint?"-fips":"";u.hostname=[p+"-"+t.accountId,o+s,d?t.region:e.service.config.region,c].join(".")}u.host=u.hostname;var l=AWS.util.uriEscape(e.params.Bucket),g=e.httpRequest.path;e.httpRequest.path=g.replace(new RegExp("/"+l),""),"/"!==e.httpRequest.path[0]&&(e.httpRequest.path="/"+e.httpRequest.path),e.httpRequest.region=t.region},addExpect100Continue:function(e){var t=e.httpRequest.headers["Content-Length"];AWS.util.isNode()&&(t>=1048576||e.params.Body instanceof AWS.util.stream.Stream)&&(e.httpRequest.headers.Expect="100-continue")},addContentType:function(e){var t=e.httpRequest;if("GET"!==t.method&&"HEAD"!==t.method){t.headers["Content-Type"]||(t.headers["Content-Type"]="application/octet-stream");var r=t.headers["Content-Type"];if(AWS.util.isBrowser())if("string"!=typeof t.body||r.match(/;\s*charset=/)){t.headers["Content-Type"]=r.replace(/(;\s*charset=)(.+)$/,(function(e,t,r){return t+r.toUpperCase()}))}else{t.headers["Content-Type"]+="; charset=UTF-8"}}else delete t.headers["Content-Type"]},willComputeChecksums:function(e){var t=e.service.api.operations[e.operation].input.members,r=e.httpRequest.body,i=e.service.config.computeChecksums&&t.ContentMD5&&!e.params.ContentMD5&&r&&(AWS.util.Buffer.isBuffer(e.httpRequest.body)||"string"==typeof e.httpRequest.body);return!(!i||!e.service.shouldDisableBodySigning(e)||e.isPresigned())||!(!i||"s3"!==this.getSignatureVersion(e)||!e.isPresigned())},computeContentMd5:function(e){if(e.service.willComputeChecksums(e)){var t=AWS.util.crypto.md5(e.httpRequest.body,"base64");e.httpRequest.headers["Content-MD5"]=t}},computeSseCustomerKeyMd5:function(e){AWS.util.each({SSECustomerKey:"x-amz-server-side-encryption-customer-key-MD5",CopySourceSSECustomerKey:"x-amz-copy-source-server-side-encryption-customer-key-MD5"},(function(t,r){if(e.params[t]){var i=AWS.util.crypto.md5(e.params[t],"base64");e.httpRequest.headers[r]=i}}))},pathStyleBucketName:function(e){return!!this.config.s3ForcePathStyle||!this.config.s3BucketEndpoint&&(!s3util.dnsCompatibleBucketName(e)||!(!this.config.sslEnabled||!e.match(/\./)))},extractErrorFrom200Response:function(e){if(operationsWith200StatusCodeError[e.request.operation]){var t=e.httpResponse;if(t.body&&t.body.toString().match("<Error>"))throw e.data=null,(this.service?this.service:this).extractError(e),e.error;if(!t.body||!t.body.toString().match(/<[\w_]/))throw e.data=null,AWS.util.error(new Error,{code:"InternalError",message:"S3 aborted request"})}},retryableError:function(e,t){return!(!operationsWith200StatusCodeError[t.operation]||200!==e.statusCode)||(!t._requestRegionForBucket||!t.service.bucketRegionCache[t._requestRegionForBucket])&&(!(!e||"RequestTimeout"!==e.code)||(e&&-1!=regionRedirectErrorCodes.indexOf(e.code)&&e.region&&e.region!=t.httpRequest.region?(t.httpRequest.region=e.region,301===e.statusCode&&t.service.updateReqBucketRegion(t),!0):AWS.Service.prototype.retryableError.call(this,e,t)))},updateReqBucketRegion:function(e,t){var r=e.httpRequest;if("string"==typeof t&&t.length&&(r.region=t),r.endpoint.host.match(/s3(?!-accelerate).*\.amazonaws\.com$/)){var i=e.service,n=i.config,o=n.s3BucketEndpoint;o&&delete n.s3BucketEndpoint;var s=AWS.util.copy(n);delete s.endpoint,s.region=r.region,r.endpoint=new AWS.S3(s).endpoint,i.populateURI(e),n.s3BucketEndpoint=o,r.headers.Host=r.endpoint.host,"validate"===e._asm.currentState&&(e.removeListener("build",i.populateURI),e.addListener("build",i.removeVirtualHostedBucketFromPath))}},extractData:function(e){var t=e.request;if("getBucketLocation"===t.operation){var r=e.httpResponse.body.toString().match(/>(.+)<\/Location/);delete e.data._,e.data.LocationConstraint=r?r[1]:""}var i=t.params.Bucket||null;if("deleteBucket"!==t.operation||"string"!=typeof i||e.error){var n=(e.httpResponse.headers||{})["x-amz-bucket-region"]||null;if(!n&&"createBucket"===t.operation&&!e.error){var o=t.params.CreateBucketConfiguration;n=o?"EU"===o.LocationConstraint?"eu-west-1":o.LocationConstraint:"us-east-1"}n&&i&&n!==t.service.bucketRegionCache[i]&&(t.service.bucketRegionCache[i]=n)}else t.service.clearBucketRegionCache(i);t.service.extractRequestIds(e)},extractError:function(e){var t,r={304:"NotModified",403:"Forbidden",400:"BadRequest",404:"NotFound"},i=e.request,n=e.httpResponse.statusCode,o=e.httpResponse.body||"",s=(e.httpResponse.headers||{})["x-amz-bucket-region"]||null,a=i.params.Bucket||null,u=i.service.bucketRegionCache;if(s&&a&&s!==u[a]&&(u[a]=s),r[n]&&0===o.length)a&&!s&&(t=u[a]||null)!==i.httpRequest.region&&(s=t),e.error=AWS.util.error(new Error,{code:r[n],message:null,region:s});else{var c=(new AWS.XML.Parser).parse(o.toString());c.Region&&!s?(s=c.Region,a&&s!==u[a]&&(u[a]=s)):!a||s||c.Region||(t=u[a]||null)!==i.httpRequest.region&&(s=t),e.error=AWS.util.error(new Error,{code:c.Code||n,message:c.Message||null,region:s})}i.service.extractRequestIds(e)},requestBucketRegion:function(e,t){var r=e.error,i=e.request,n=i.params.Bucket||null;if(!r||!n||r.region||"listObjects"===i.operation||AWS.util.isNode()&&"headBucket"===i.operation||400===r.statusCode&&"headObject"!==i.operation||-1===regionRedirectErrorCodes.indexOf(r.code))return t();var o=AWS.util.isNode()?"headBucket":"listObjects",s={Bucket:n};"listObjects"===o&&(s.MaxKeys=0);var a=i.service[o](s);a._requestRegionForBucket=n,a.send((function(){var e=i.service.bucketRegionCache[n]||null;r.region=e,t()}))},reqRegionForNetworkingError:function(e,t){if(!AWS.util.isBrowser())return t();var r=e.error,i=e.request,n=i.params.Bucket;if(!r||"NetworkingError"!==r.code||!n||"us-east-1"===i.httpRequest.region)return t();var o=i.service,s=o.bucketRegionCache,a=s[n]||null;if(a&&a!==i.httpRequest.region)o.updateReqBucketRegion(i,a),t();else if(s3util.dnsCompatibleBucketName(n))if(i.httpRequest.virtualHostedBucket){var u=o.listObjects({Bucket:n,MaxKeys:0});o.updateReqBucketRegion(u,"us-east-1"),u._requestRegionForBucket=n,u.send((function(){var e=o.bucketRegionCache[n]||null;e&&e!==i.httpRequest.region&&o.updateReqBucketRegion(i,e),t()}))}else t();else o.updateReqBucketRegion(i,"us-east-1"),"us-east-1"!==s[n]&&(s[n]="us-east-1"),t()},bucketRegionCache:{},clearBucketRegionCache:function(e){var t=this.bucketRegionCache;e?"string"==typeof e&&(e=[e]):e=Object.keys(t);for(var r=0;r<e.length;r++)delete t[e[r]];return t},correctBucketRegionFromCache:function(e){var t=e.params.Bucket||null;if(t){var r=e.service,i=e.httpRequest.region,n=r.bucketRegionCache[t];n&&n!==i&&r.updateReqBucketRegion(e,n)}},extractRequestIds:function(e){var t=e.httpResponse.headers?e.httpResponse.headers["x-amz-id-2"]:null,r=e.httpResponse.headers?e.httpResponse.headers["x-amz-cf-id"]:null;e.extendedRequestId=t,e.cfId=r,e.error&&(e.error.requestId=e.requestId||null,e.error.extendedRequestId=t,e.error.cfId=r)},getSignedUrl:function(e,t,r){var i=(t=AWS.util.copy(t||{})).Expires||900;if("number"!=typeof i)throw AWS.util.error(new Error,{code:"InvalidParameterException",message:"The expiration must be a number, received "+typeof i});delete t.Expires;var n=this.makeRequest(e,t);if(!r)return n.presign(i,r);AWS.util.defer((function(){n.presign(i,r)}))},createPresignedPost:function(e,t){"function"==typeof e&&void 0===t&&(t=e,e=null),e=AWS.util.copy(e||{});var r=this.config.params||{},i=e.Bucket||r.Bucket,n=this,o=this.config,s=AWS.util.copy(this.endpoint);function a(){return{url:AWS.util.urlFormat(s),fields:n.preparePostFields(o.credentials,o.region,i,e.Fields,e.Conditions,e.Expires)}}if(o.s3BucketEndpoint||(s.pathname="/"+i),!t)return a();o.getCredentials((function(e){if(e)t(e);else try{t(null,a())}catch(e){t(e)}}))},preparePostFields:function(e,t,r,i,n,o){var s=this.getSkewCorrectedDate();if(!e||!t||!r)throw new Error("Unable to create a POST object policy without a bucket, region, and credentials");i=AWS.util.copy(i||{}),n=(n||[]).slice(0),o=o||3600;var a=AWS.util.date.iso8601(s).replace(/[:\-]|\.\d{3}/g,""),u=a.substr(0,8),c=v4Credentials.createScope(u,t,"s3"),d=e.accessKeyId+"/"+c;for(var p in i.bucket=r,i["X-Amz-Algorithm"]="AWS4-HMAC-SHA256",i["X-Amz-Credential"]=d,i["X-Amz-Date"]=a,e.sessionToken&&(i["X-Amz-Security-Token"]=e.sessionToken),i)if(i.hasOwnProperty(p)){var l={};l[p]=i[p],n.push(l)}return i.Policy=this.preparePostPolicy(new Date(s.valueOf()+1e3*o),n),i["X-Amz-Signature"]=AWS.util.crypto.hmac(v4Credentials.getSigningKey(e,u,t,"s3",!0),i.Policy,"hex"),i},preparePostPolicy:function(e,t){return AWS.util.base64.encode(JSON.stringify({expiration:AWS.util.date.iso8601(e),conditions:t}))},prepareSignedUrl:function(e){e.addListener("validate",e.service.noPresignedContentLength),e.removeListener("build",e.service.addContentType),e.params.Body?e.addListener("afterBuild",AWS.EventListeners.Core.COMPUTE_SHA256):e.removeListener("build",e.service.computeContentMd5)},disableBodySigning:function(e){var t=e.httpRequest.headers;Object.prototype.hasOwnProperty.call(t,"presigned-expires")||(t["X-Amz-Content-Sha256"]="UNSIGNED-PAYLOAD")},noPresignedContentLength:function(e){if(void 0!==e.params.ContentLength)throw AWS.util.error(new Error,{code:"UnexpectedParameter",message:"ContentLength is not supported in pre-signed URLs."})},createBucket:function(e,t){"function"!=typeof e&&e||(t=t||e,e={});var r=this.endpoint.hostname,i=AWS.util.copy(e);return r===this.api.globalEndpoint||e.CreateBucketConfiguration||(i.CreateBucketConfiguration={LocationConstraint:this.config.region}),this.makeRequest("createBucket",i,t)},writeGetObjectResponse:function(e,t){var r=this.makeRequest("writeGetObjectResponse",AWS.util.copy(e),t),i=this.endpoint.hostname;return i=-1!==i.indexOf(this.config.region)?i.replace("s3.",OBJECT_LAMBDA_SERVICE+"."):i.replace("s3.",OBJECT_LAMBDA_SERVICE+"."+this.config.region+"."),r.httpRequest.endpoint=new AWS.Endpoint(i,this.config),r},upload:function(e,t,r){"function"==typeof t&&void 0===r&&(r=t,t=null),t=t||{},t=AWS.util.merge(t||{},{service:this,params:e});var i=new AWS.S3.ManagedUpload(t);return"function"==typeof r&&i.send(r),i}}),AWS.S3.addPromisesToClass=function(e){this.prototype.getSignedUrlPromise=AWS.util.promisifyMethod("getSignedUrl",e)},AWS.S3.deletePromisesFromClass=function(){delete this.prototype.getSignedUrlPromise},AWS.util.addPromises(AWS.S3);
//# sourceMappingURL=/sm/a5bfc0cd47c4508cca5b377516f69acde93a2dfec73c4b0e8bd734961aedec51.map
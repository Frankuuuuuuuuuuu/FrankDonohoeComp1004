/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/aws-sdk@2.1342.0/lib/credentials/cognito_identity_credentials.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var AWS=require("../core"),CognitoIdentity=require("../../clients/cognitoidentity"),STS=require("../../clients/sts");AWS.CognitoIdentityCredentials=AWS.util.inherit(AWS.Credentials,{localStorageKey:{id:"aws.cognito.identity-id.",providers:"aws.cognito.identity-providers."},constructor:function(t,e){AWS.Credentials.call(this),this.expired=!0,this.params=t,this.data=null,this._identityId=null,this._clientConfig=AWS.util.copy(e||{}),this.loadCachedId();var i=this;Object.defineProperty(this,"identityId",{get:function(){return i.loadCachedId(),i._identityId||i.params.IdentityId},set:function(t){i._identityId=t}})},refresh:function(t){this.coalesceRefresh(t||AWS.util.fn.callback)},load:function(t){var e=this;e.createClients(),e.data=null,e._identityId=null,e.getId((function(i){i?(e.clearIdOnNotAuthorized(i),t(i)):e.params.RoleArn?e.getCredentialsFromSTS(t):e.getCredentialsForIdentity(t)}))},clearCachedId:function(){this._identityId=null,delete this.params.IdentityId;var t=this.params.IdentityPoolId,e=this.params.LoginId||"";delete this.storage[this.localStorageKey.id+t+e],delete this.storage[this.localStorageKey.providers+t+e]},clearIdOnNotAuthorized:function(t){"NotAuthorizedException"==t.code&&this.clearCachedId()},getId:function(t){var e=this;if("string"==typeof e.params.IdentityId)return t(null,e.params.IdentityId);e.cognito.getId((function(i,n){!i&&n.IdentityId?(e.params.IdentityId=n.IdentityId,t(null,n.IdentityId)):t(i)}))},loadCredentials:function(t,e){t&&e&&(e.expired=!1,e.accessKeyId=t.Credentials.AccessKeyId,e.secretAccessKey=t.Credentials.SecretKey,e.sessionToken=t.Credentials.SessionToken,e.expireTime=t.Credentials.Expiration)},getCredentialsForIdentity:function(t){var e=this;e.cognito.getCredentialsForIdentity((function(i,n){i?e.clearIdOnNotAuthorized(i):(e.cacheId(n),e.data=n,e.loadCredentials(e.data,e)),t(i)}))},getCredentialsFromSTS:function(t){var e=this;e.cognito.getOpenIdToken((function(i,n){i?(e.clearIdOnNotAuthorized(i),t(i)):(e.cacheId(n),e.params.WebIdentityToken=n.Token,e.webIdentityCredentials.refresh((function(i){i||(e.data=e.webIdentityCredentials.data,e.sts.credentialsFrom(e.data,e)),t(i)})))}))},loadCachedId:function(){var t=this;if(AWS.util.isBrowser()&&!t.params.IdentityId){var e=t.getStorage("id");if(e&&t.params.Logins){var i=Object.keys(t.params.Logins);0!==(t.getStorage("providers")||"").split(",").filter((function(t){return-1!==i.indexOf(t)})).length&&(t.params.IdentityId=e)}else e&&(t.params.IdentityId=e)}},createClients:function(){var t=this._clientConfig;if(this.webIdentityCredentials=this.webIdentityCredentials||new AWS.WebIdentityCredentials(this.params,t),!this.cognito){var e=AWS.util.merge({},t);e.params=this.params,this.cognito=new CognitoIdentity(e)}this.sts=this.sts||new STS(t)},cacheId:function(t){this._identityId=t.IdentityId,this.params.IdentityId=this._identityId,AWS.util.isBrowser()&&(this.setStorage("id",t.IdentityId),this.params.Logins&&this.setStorage("providers",Object.keys(this.params.Logins).join(",")))},getStorage:function(t){return this.storage[this.localStorageKey[t]+this.params.IdentityPoolId+(this.params.LoginId||"")]},setStorage:function(t,e){try{this.storage[this.localStorageKey[t]+this.params.IdentityPoolId+(this.params.LoginId||"")]=e}catch(t){}},storage:function(){try{var t=AWS.util.isBrowser()&&null!==window.localStorage&&"object"==typeof window.localStorage?window.localStorage:{};return t["aws.test-storage"]="foobar",delete t["aws.test-storage"],t}catch(t){return{}}}()});
//# sourceMappingURL=/sm/f3c46b22b8081fecdf96bf7901cc6a48528a749cdd10c9a1f54118886561f246.map
/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/aws-sdk@2.1342.0/lib/credentials/token_file_web_identity_credentials.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var AWS=require("../core"),fs=require("fs"),STS=require("../../clients/sts"),iniLoader=AWS.util.iniLoader;AWS.TokenFileWebIdentityCredentials=AWS.util.inherit(AWS.Credentials,{constructor:function(e){AWS.Credentials.call(this),this.data=null,this.clientConfig=AWS.util.copy(e||{})},getParamsFromEnv:function(){var e="AWS_WEB_IDENTITY_TOKEN_FILE";if(process.env[e]&&process.env.AWS_ROLE_ARN)return[{envTokenFile:process.env[e],roleArn:process.env.AWS_ROLE_ARN,roleSessionName:process.env.AWS_ROLE_SESSION_NAME}]},getParamsFromSharedConfig:function(){var e=AWS.util.getProfilesFromSharedConfig(iniLoader),i=process.env.AWS_PROFILE||AWS.util.defaultProfile,r=e[i]||{};if(0===Object.keys(r).length)throw AWS.util.error(new Error("Profile "+i+" not found"),{code:"TokenFileWebIdentityCredentialsProviderFailure"});for(var n=[];!r.web_identity_token_file&&r.source_profile;){n.unshift({roleArn:r.role_arn,roleSessionName:r.role_session_name}),r=e[r.source_profile]}return n.unshift({envTokenFile:r.web_identity_token_file,roleArn:r.role_arn,roleSessionName:r.role_session_name}),n},refresh:function(e){this.coalesceRefresh(e||AWS.util.fn.callback)},assumeRoleChaining:function(e,i){var r=this;if(0===e.length)r.service.credentialsFrom(r.data,r),i();else{var n=e.shift();r.service.config.credentials=r.service.credentialsFrom(r.data,r),r.service.assumeRole({RoleArn:n.roleArn,RoleSessionName:n.roleSessionName||"token-file-web-identity"},(function(n,o){r.data=null,n?i(n):(r.data=o,r.assumeRoleChaining(e,i))}))}},load:function(e){var i=this;try{var r=i.getParamsFromEnv();if(r||(r=i.getParamsFromSharedConfig()),r){var n=r.shift(),o=fs.readFileSync(n.envTokenFile,{encoding:"ascii"});i.service||i.createClients(),i.service.assumeRoleWithWebIdentity({WebIdentityToken:o,RoleArn:n.roleArn,RoleSessionName:n.roleSessionName||"token-file-web-identity"},(function(n,o){i.data=null,n?e(n):(i.data=o,i.assumeRoleChaining(r,e))}))}}catch(i){e(i)}},createClients:function(){if(!this.service){var e=AWS.util.merge({},this.clientConfig);this.service=new STS(e),this.service.retryableError=function(e){return"IDPCommunicationErrorException"===e.code||"InvalidIdentityToken"===e.code||AWS.Service.prototype.retryableError.call(this,e)}}}});
//# sourceMappingURL=/sm/4e87d0f8377beaaa115cb10cc9fd6b44f5ca8066668daafed137e71f2f8c4c96.map
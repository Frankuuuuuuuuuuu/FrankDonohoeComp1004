/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/aws-sdk@2.1342.0/lib/event_listeners.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var AWS=require("./core"),SequentialExecutor=require("./sequential_executor"),DISCOVER_ENDPOINT=require("./discover_endpoint").discoverEndpoint;function getOperationAuthtype(e){if(!e.service.api.operations)return"";var r=e.service.api.operations[e.operation];return r?r.authtype:""}function getIdentityType(e){var r=e.service;return r.config.signatureVersion?r.config.signatureVersion:r.api.signatureVersion?r.api.signatureVersion:getOperationAuthtype(e)}AWS.EventListeners={Core:{}},AWS.EventListeners={Core:(new SequentialExecutor).addNamedListeners((function(e,r){r("VALIDATE_CREDENTIALS","validate",(function(e,r){if(!e.service.api.signatureVersion&&!e.service.config.signatureVersion)return r();"bearer"!==getIdentityType(e)?e.service.config.getCredentials((function(t){t&&(e.response.error=AWS.util.error(t,{code:"CredentialsError",message:"Missing credentials in config, if using AWS_CONFIG_FILE, set AWS_SDK_LOAD_CONFIG=1"})),r()})):e.service.config.getToken((function(t){t&&(e.response.error=AWS.util.error(t,{code:"TokenError"})),r()}))})),e("VALIDATE_REGION","validate",(function(e){if(!e.service.isGlobalEndpoint){var r=new RegExp(/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9])$/);e.service.config.region?r.test(e.service.config.region)||(e.response.error=AWS.util.error(new Error,{code:"ConfigError",message:"Invalid region in config"})):e.response.error=AWS.util.error(new Error,{code:"ConfigError",message:"Missing region in config"})}})),e("BUILD_IDEMPOTENCY_TOKENS","validate",(function(e){if(e.service.api.operations){var r=e.service.api.operations[e.operation];if(r){var t=r.idempotentMembers;if(t.length){for(var n=AWS.util.copy(e.params),i=0,o=t.length;i<o;i++)n[t[i]]||(n[t[i]]=AWS.util.uuid.v4());e.params=n}}}})),e("VALIDATE_PARAMETERS","validate",(function(e){if(e.service.api.operations){var r=e.service.api.operations[e.operation].input,t=e.service.config.paramValidation;new AWS.ParamValidator(t).validate(r,e.params)}})),e("COMPUTE_CHECKSUM","afterBuild",(function(e){if(e.service.api.operations){var r=e.service.api.operations[e.operation];if(r){var t=e.httpRequest.body,n=t&&(AWS.util.Buffer.isBuffer(t)||"string"==typeof t),i=e.httpRequest.headers;if(r.httpChecksumRequired&&e.service.config.computeChecksums&&n&&!i["Content-MD5"]){var o=AWS.util.crypto.md5(t,"base64");i["Content-MD5"]=o}}}})),r("COMPUTE_SHA256","afterBuild",(function(e,r){if(e.haltHandlersOnError(),e.service.api.operations){var t=e.service.api.operations[e.operation],n=t?t.authtype:"";if(!e.service.api.signatureVersion&&!n&&!e.service.config.signatureVersion)return r();if(e.service.getSignerClass(e)===AWS.Signers.V4){var i=e.httpRequest.body||"";if(n.indexOf("unsigned-body")>=0)return e.httpRequest.headers["X-Amz-Content-Sha256"]="UNSIGNED-PAYLOAD",r();AWS.util.computeSha256(i,(function(t,n){t?r(t):(e.httpRequest.headers["X-Amz-Content-Sha256"]=n,r())}))}else r()}})),e("SET_CONTENT_LENGTH","afterBuild",(function(e){var r=getOperationAuthtype(e),t=AWS.util.getRequestPayloadShape(e);if(void 0===e.httpRequest.headers["Content-Length"])try{var n=AWS.util.string.byteLength(e.httpRequest.body);e.httpRequest.headers["Content-Length"]=n}catch(n){if(t&&t.isStreaming){if(t.requiresLength)throw n;if(r.indexOf("unsigned-body")>=0)return void(e.httpRequest.headers["Transfer-Encoding"]="chunked");throw n}throw n}})),e("SET_HTTP_HOST","afterBuild",(function(e){e.httpRequest.headers.Host=e.httpRequest.endpoint.host})),e("SET_TRACE_ID","afterBuild",(function(e){var r="X-Amzn-Trace-Id";if(AWS.util.isNode()&&!Object.hasOwnProperty.call(e.httpRequest.headers,r)){var t=process.env.AWS_LAMBDA_FUNCTION_NAME,n=process.env._X_AMZN_TRACE_ID;"string"==typeof t&&t.length>0&&"string"==typeof n&&n.length>0&&(e.httpRequest.headers[r]=n)}})),e("RESTART","restart",(function(){var e=this.response.error;e&&e.retryable&&(this.httpRequest=new AWS.HttpRequest(this.service.endpoint,this.service.region),this.response.retryCount<this.service.config.maxRetries?this.response.retryCount++:this.response.error=null)}));r("DISCOVER_ENDPOINT","sign",DISCOVER_ENDPOINT,!0),r("SIGN","sign",(function(e,r){var t=e.service,n=getIdentityType(e);if(!n||0===n.length)return r();"bearer"===n?t.config.getToken((function(n,i){if(n)return e.response.error=n,r();try{new(t.getSignerClass(e))(e.httpRequest).addAuthorization(i)}catch(r){e.response.error=r}r()})):t.config.getCredentials((function(n,i){if(n)return e.response.error=n,r();try{var o=t.getSkewCorrectedDate(),s=t.getSignerClass(e),a=(e.service.api.operations||{})[e.operation],u=new s(e.httpRequest,t.getSigningName(e),{signatureCache:t.config.signatureCache,operation:a,signatureVersion:t.api.signatureVersion});u.setServiceClientId(t._clientId),delete e.httpRequest.headers.Authorization,delete e.httpRequest.headers.Date,delete e.httpRequest.headers["X-Amz-Date"],u.addAuthorization(i,o),e.signedAt=o}catch(r){e.response.error=r}r()}))})),e("VALIDATE_RESPONSE","validateResponse",(function(e){this.service.successfulResponse(e,this)?(e.data={},e.error=null):(e.data=null,e.error=AWS.util.error(new Error,{code:"UnknownError",message:"An unknown error occurred."}))})),e("ERROR","error",(function(e,r){if(r.request.service.api.awsQueryCompatible){var t=r.httpResponse.headers,n=t?t["x-amzn-query-error"]:void 0;n&&n.includes(";")&&(r.error.code=n.split(";")[0])}}),!0),r("SEND","send",(function(e,r){function t(t){e.httpResponse.stream=t;var n=e.request.httpRequest.stream,i=e.request.service,o=i.api,s=e.request.operation,a=o.operations[s]||{};t.on("headers",(function(n,o,s){if(e.request.emit("httpHeaders",[n,o,e,s]),!e.httpResponse.streaming)if(2===AWS.HttpClient.streamsApiVersion){if(a.hasEventOutput&&i.successfulResponse(e))return e.request.emit("httpDone"),void r();t.on("readable",(function(){var r=t.read();null!==r&&e.request.emit("httpData",[r,e])}))}else t.on("data",(function(r){e.request.emit("httpData",[r,e])}))})),t.on("end",(function(){if(!n||!n.didCallback){if(2===AWS.HttpClient.streamsApiVersion&&a.hasEventOutput&&i.successfulResponse(e))return;e.request.emit("httpDone"),r()}}))}function n(t){if("RequestAbortedError"!==t.code){var n="TimeoutError"===t.code?t.code:"NetworkingError";t=AWS.util.error(t,{code:n,region:e.request.httpRequest.region,hostname:e.request.httpRequest.endpoint.hostname,retryable:!0})}e.error=t,e.request.emit("httpError",[e.error,e],(function(){r()}))}function i(){var r,i=AWS.HttpClient.getInstance(),o=e.request.service.config.httpOptions||{};try{var s=i.handleRequest(e.request.httpRequest,o,t,n);(r=s).on("sendProgress",(function(r){e.request.emit("httpUploadProgress",[r,e])})),r.on("receiveProgress",(function(r){e.request.emit("httpDownloadProgress",[r,e])}))}catch(e){n(e)}}e.httpResponse._abortCallback=r,e.error=null,e.data=null,(e.request.service.getSkewCorrectedDate()-this.signedAt)/1e3>=600?this.emit("sign",[this],(function(e){e?r(e):i()})):i()})),e("HTTP_HEADERS","httpHeaders",(function(e,r,t,n){t.httpResponse.statusCode=e,t.httpResponse.statusMessage=n,t.httpResponse.headers=r,t.httpResponse.body=AWS.util.buffer.toBuffer(""),t.httpResponse.buffers=[],t.httpResponse.numBytes=0;var i=r.date||r.Date,o=t.request.service;if(i){var s=Date.parse(i);o.config.correctClockSkew&&o.isClockSkewed(s)&&o.applyClockOffset(s)}})),e("HTTP_DATA","httpData",(function(e,r){if(e){if(AWS.util.isNode()){r.httpResponse.numBytes+=e.length;var t=r.httpResponse.headers["content-length"],n={loaded:r.httpResponse.numBytes,total:t};r.request.emit("httpDownloadProgress",[n,r])}r.httpResponse.buffers.push(AWS.util.buffer.toBuffer(e))}})),e("HTTP_DONE","httpDone",(function(e){if(e.httpResponse.buffers&&e.httpResponse.buffers.length>0){var r=AWS.util.buffer.concat(e.httpResponse.buffers);e.httpResponse.body=r}delete e.httpResponse.numBytes,delete e.httpResponse.buffers})),e("FINALIZE_ERROR","retry",(function(e){e.httpResponse.statusCode&&(e.error.statusCode=e.httpResponse.statusCode,void 0===e.error.retryable&&(e.error.retryable=this.service.retryableError(e.error,this)))})),e("INVALIDATE_CREDENTIALS","retry",(function(e){if(e.error)switch(e.error.code){case"RequestExpired":case"ExpiredTokenException":case"ExpiredToken":e.error.retryable=!0,e.request.service.config.credentials.expired=!0}})),e("EXPIRED_SIGNATURE","retry",(function(e){var r=e.error;r&&"string"==typeof r.code&&"string"==typeof r.message&&r.code.match(/Signature/)&&r.message.match(/expired/)&&(e.error.retryable=!0)})),e("CLOCK_SKEWED","retry",(function(e){e.error&&this.service.clockSkewError(e.error)&&this.service.config.correctClockSkew&&(e.error.retryable=!0)})),e("REDIRECT","retry",(function(e){e.error&&e.error.statusCode>=300&&e.error.statusCode<400&&e.httpResponse.headers.location&&(this.httpRequest.endpoint=new AWS.Endpoint(e.httpResponse.headers.location),this.httpRequest.headers.Host=this.httpRequest.endpoint.host,e.error.redirect=!0,e.error.retryable=!0)})),e("RETRY_CHECK","retry",(function(e){e.error&&(e.error.redirect&&e.redirectCount<e.maxRedirects?e.error.retryDelay=0:e.retryCount<e.maxRetries&&(e.error.retryDelay=this.service.retryDelays(e.retryCount,e.error)||0))})),r("RESET_RETRY_STATE","afterRetry",(function(e,r){var t,n=!1;e.error&&(t=e.error.retryDelay||0,e.error.retryable&&e.retryCount<e.maxRetries?(e.retryCount++,n=!0):e.error.redirect&&e.redirectCount<e.maxRedirects&&(e.redirectCount++,n=!0)),n&&t>=0?(e.error=null,setTimeout(r,t)):r()}))})),CorePost:(new SequentialExecutor).addNamedListeners((function(e){e("EXTRACT_REQUEST_ID","extractData",AWS.util.extractRequestId),e("EXTRACT_REQUEST_ID","extractError",AWS.util.extractRequestId),e("ENOTFOUND_ERROR","httpError",(function(e){if("NetworkingError"===e.code&&function(e){return"ENOTFOUND"===e.errno||"number"==typeof e.errno&&"function"==typeof AWS.util.getSystemErrorName&&["EAI_NONAME","EAI_NODATA"].indexOf(AWS.util.getSystemErrorName(e.errno)>=0)}(e)){var r="Inaccessible host: `"+e.hostname+"' at port `"+e.port+"'. This service may not be available in the `"+e.region+"' region.";this.response.error=AWS.util.error(new Error(r),{code:"UnknownEndpoint",region:e.region,hostname:e.hostname,retryable:!0,originalError:e})}}))})),Logger:(new SequentialExecutor).addNamedListeners((function(e){e("LOG_REQUEST","complete",(function(e){var r=e.request,t=r.service.config.logger;if(t){var n=function(){var n=(e.request.service.getSkewCorrectedDate().getTime()-r.startTime.getTime())/1e3,o=!!t.isTTY,s=e.httpResponse.statusCode,a=r.params;r.service.api.operations&&r.service.api.operations[r.operation]&&r.service.api.operations[r.operation].input&&(a=i(r.service.api.operations[r.operation].input,r.params));var u=require("util").inspect(a,!0,null),c="";return o&&(c+="[33m"),c+="[AWS "+r.service.serviceIdentifier+" "+s,c+=" "+n.toString()+"s "+e.retryCount+" retries]",o&&(c+="[0;1m"),c+=" "+AWS.util.string.lowerFirst(r.operation),c+="("+u+")",o&&(c+="[0m"),c}();"function"==typeof t.log?t.log(n):"function"==typeof t.write&&t.write(n+"\n")}function i(e,r){if(!r)return r;if(e.isSensitive)return"***SensitiveInformation***";switch(e.type){case"structure":var t={};return AWS.util.each(r,(function(r,n){Object.prototype.hasOwnProperty.call(e.members,r)?t[r]=i(e.members[r],n):t[r]=n})),t;case"list":var n=[];return AWS.util.arrayEach(r,(function(r,t){n.push(i(e.member,r))})),n;case"map":var o={};return AWS.util.each(r,(function(r,t){o[r]=i(e.value,t)})),o;default:return r}}}))})),Json:(new SequentialExecutor).addNamedListeners((function(e){var r=require("./protocol/json");e("BUILD","build",r.buildRequest),e("EXTRACT_DATA","extractData",r.extractData),e("EXTRACT_ERROR","extractError",r.extractError)})),Rest:(new SequentialExecutor).addNamedListeners((function(e){var r=require("./protocol/rest");e("BUILD","build",r.buildRequest),e("EXTRACT_DATA","extractData",r.extractData),e("EXTRACT_ERROR","extractError",r.extractError)})),RestJson:(new SequentialExecutor).addNamedListeners((function(e){var r=require("./protocol/rest_json");e("BUILD","build",r.buildRequest),e("EXTRACT_DATA","extractData",r.extractData),e("EXTRACT_ERROR","extractError",r.extractError),e("UNSET_CONTENT_LENGTH","afterBuild",r.unsetContentLength)})),RestXml:(new SequentialExecutor).addNamedListeners((function(e){var r=require("./protocol/rest_xml");e("BUILD","build",r.buildRequest),e("EXTRACT_DATA","extractData",r.extractData),e("EXTRACT_ERROR","extractError",r.extractError)})),Query:(new SequentialExecutor).addNamedListeners((function(e){var r=require("./protocol/query");e("BUILD","build",r.buildRequest),e("EXTRACT_DATA","extractData",r.extractData),e("EXTRACT_ERROR","extractError",r.extractError)}))};
//# sourceMappingURL=/sm/901b1db2c09d52b8956c50531b23a2c5cf6053e888e70f6b1ccfcdf33339ac7d.map
/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/aws-sdk@2.1342.0/lib/discover_endpoint.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var AWS=require("./core"),util=require("./util"),endpointDiscoveryEnabledEnvs=["AWS_ENABLE_ENDPOINT_DISCOVERY","AWS_ENDPOINT_DISCOVERY_ENABLED"];function getCacheKey(e){var i=e.service,n=i.api||{},r=(n.operations,{});return i.config.region&&(r.region=i.config.region),n.serviceId&&(r.serviceId=n.serviceId),i.config.credentials.accessKeyId&&(r.accessKeyId=i.config.credentials.accessKeyId),r}function marshallCustomIdentifiersHelper(e,i,n){n&&null!=i&&"structure"===n.type&&n.required&&n.required.length>0&&util.arrayEach(n.required,(function(r){var t=n.members[r];if(!0===t.endpointDiscoveryId){var o=t.isLocationName?t.name:r;e[o]=String(i[r])}else marshallCustomIdentifiersHelper(e,i[r],t)}))}function marshallCustomIdentifiers(e,i){var n={};return marshallCustomIdentifiersHelper(n,e.params,i),n}function optionalDiscoverEndpoint(e){var i=e.service,n=i.api,r=n.operations?n.operations[e.operation]:void 0,t=marshallCustomIdentifiers(e,r?r.input:void 0),o=getCacheKey(e);Object.keys(t).length>0&&(o=util.update(o,t),r&&(o.operation=r.name));var s=AWS.endpointCache.get(o);if(!s||1!==s.length||""!==s[0].Address)if(s&&s.length>0)e.httpRequest.updateEndpoint(s[0].Address);else{var a=i.makeRequest(n.endpointOperation,{Operation:r.name,Identifiers:t});addApiVersionHeader(a),a.removeListener("validate",AWS.EventListeners.Core.VALIDATE_PARAMETERS),a.removeListener("retry",AWS.EventListeners.Core.RETRY_CHECK),AWS.endpointCache.put(o,[{Address:"",CachePeriodInMinutes:1}]),a.send((function(e,i){i&&i.Endpoints?AWS.endpointCache.put(o,i.Endpoints):e&&AWS.endpointCache.put(o,[{Address:"",CachePeriodInMinutes:1}])}))}}var requestQueue={};function requiredDiscoverEndpoint(e,i){var n=e.service,r=n.api,t=r.operations?r.operations[e.operation]:void 0,o=t?t.input:void 0,s=marshallCustomIdentifiers(e,o),a=getCacheKey(e);Object.keys(s).length>0&&(a=util.update(a,s),t&&(a.operation=t.name));var d=AWS.EndpointCache.getKeyString(a),p=AWS.endpointCache.get(d);if(p&&1===p.length&&""===p[0].Address)return requestQueue[d]||(requestQueue[d]=[]),void requestQueue[d].push({request:e,callback:i});if(p&&p.length>0)e.httpRequest.updateEndpoint(p[0].Address),i();else{var u=n.makeRequest(r.endpointOperation,{Operation:t.name,Identifiers:s});u.removeListener("validate",AWS.EventListeners.Core.VALIDATE_PARAMETERS),addApiVersionHeader(u),AWS.endpointCache.put(d,[{Address:"",CachePeriodInMinutes:60}]),u.send((function(n,r){if(n){if(e.response.error=util.error(n,{retryable:!1}),AWS.endpointCache.remove(a),requestQueue[d]){var t=requestQueue[d];util.arrayEach(t,(function(e){e.request.response.error=util.error(n,{retryable:!1}),e.callback()})),delete requestQueue[d]}}else if(r&&(AWS.endpointCache.put(d,r.Endpoints),e.httpRequest.updateEndpoint(r.Endpoints[0].Address),requestQueue[d])){t=requestQueue[d];util.arrayEach(t,(function(e){e.request.httpRequest.updateEndpoint(r.Endpoints[0].Address),e.callback()})),delete requestQueue[d]}i()}))}}function addApiVersionHeader(e){var i=e.service.api.apiVersion;i&&!e.httpRequest.headers["x-amz-api-version"]&&(e.httpRequest.headers["x-amz-api-version"]=i)}function invalidateCachedEndpoints(e){var i=e.error,n=e.httpResponse;if(i&&("InvalidEndpointException"===i.code||421===n.statusCode)){var r=e.request,t=r.service.api.operations||{},o=marshallCustomIdentifiers(r,t[r.operation]?t[r.operation].input:void 0),s=getCacheKey(r);Object.keys(o).length>0&&(s=util.update(s,o),t[r.operation]&&(s.operation=t[r.operation].name)),AWS.endpointCache.remove(s)}}function hasCustomEndpoint(e){if(e._originalConfig&&e._originalConfig.endpoint&&!0===e._originalConfig.endpointDiscoveryEnabled)throw util.error(new Error,{code:"ConfigurationException",message:"Custom endpoint is supplied; endpointDiscoveryEnabled must not be true."});var i=AWS.config[e.serviceIdentifier]||{};return Boolean(AWS.config.endpoint||i.endpoint||e._originalConfig&&e._originalConfig.endpoint)}function isFalsy(e){return["false","0"].indexOf(e)>=0}function resolveEndpointDiscoveryConfig(e){var i=e.service||{};if(void 0!==i.config.endpointDiscoveryEnabled)return i.config.endpointDiscoveryEnabled;if(!util.isBrowser()){for(var n=0;n<endpointDiscoveryEnabledEnvs.length;n++){var r=endpointDiscoveryEnabledEnvs[n];if(Object.prototype.hasOwnProperty.call(process.env,r)){if(""===process.env[r]||void 0===process.env[r])throw util.error(new Error,{code:"ConfigurationException",message:"environmental variable "+r+" cannot be set to nothing"});return!isFalsy(process.env[r])}}var t={};try{t=AWS.util.iniLoader?AWS.util.iniLoader.loadFrom({isConfig:!0,filename:process.env[AWS.util.sharedConfigFileEnv]}):{}}catch(e){}var o=t[process.env.AWS_PROFILE||AWS.util.defaultProfile]||{};if(Object.prototype.hasOwnProperty.call(o,"endpoint_discovery_enabled")){if(void 0===o.endpoint_discovery_enabled)throw util.error(new Error,{code:"ConfigurationException",message:"config file entry 'endpoint_discovery_enabled' cannot be set to nothing"});return!isFalsy(o.endpoint_discovery_enabled)}}}function discoverEndpoint(e,i){var n=e.service||{};if(hasCustomEndpoint(n)||e.isPresigned())return i();var r=(n.api.operations||{})[e.operation],t=r?r.endpointDiscoveryRequired:"NULL",o=resolveEndpointDiscoveryConfig(e),s=n.api.hasRequiredEndpointDiscovery;switch((o||s)&&e.httpRequest.appendToUserAgent("endpoint-discovery"),t){case"OPTIONAL":(o||s)&&(optionalDiscoverEndpoint(e),e.addNamedListener("INVALIDATE_CACHED_ENDPOINTS","extractError",invalidateCachedEndpoints)),i();break;case"REQUIRED":if(!1===o){e.response.error=util.error(new Error,{code:"ConfigurationException",message:"Endpoint Discovery is disabled but "+n.api.className+"."+e.operation+"() requires it. Please check your configurations."}),i();break}e.addNamedListener("INVALIDATE_CACHED_ENDPOINTS","extractError",invalidateCachedEndpoints),requiredDiscoverEndpoint(e,i);break;default:i()}}module.exports={discoverEndpoint:discoverEndpoint,requiredDiscoverEndpoint:requiredDiscoverEndpoint,optionalDiscoverEndpoint:optionalDiscoverEndpoint,marshallCustomIdentifiers:marshallCustomIdentifiers,getCacheKey:getCacheKey,invalidateCachedEndpoint:invalidateCachedEndpoints};
//# sourceMappingURL=/sm/6827f2f6e9e5530b6b6dff62393e9ccfdad45c71d44e7f81c0db5a72b5fe2a83.map